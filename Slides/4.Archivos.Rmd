---
title: "4.Archivos"
output:
  ioslides_presentation:
    widescreen: yes
  slidy_presentation: default
date: "2/3/2021"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Flujo de trabajo

<div class="centered">
  <img src="../Images/workflow.png" alt="workflow" width="800"/>
</div>

## FastQ
<div class="black">
- Derivado del formato FASTA
- FASTA + Id secuencia + **Calidad**
- Generalmente no está comprimido (.fastq) > comprimir (.fastq.gz)
- Comprende 4 líneas por secuencia:
  * @ ID del read + información de la corrida
  * Secuencia 
  * Símbolo "+"
  * Calidad (Escala **Phred** y código **ASCII**)
</div>

## FastQ | Identificador
<div class="black">
- El identificador de la secuencia es la primera línea del archivo .fastq
- Plataformas de Illumina superiores a 1.8 contienen la siguiente información:

<div class="green">
**@machneID:run number:flowCell ID:lane:tile:read:control number:index**
</div>

### <b>
```{bash echo = F}
gzcat ../Data/s1_R1.fastq.gz | head -n 1
```
### </b>

## FastQ | Calidad
<div class="black">
La calidad de cada base secuenciada, en la escala **Phred**, se calcula de acuerdo la siguiente ecuación:

<div class="centered">
**Q = -10 * log10(p)**
</div>

Q = Calidad 

p = Probabilidad de que el base call sea incorrecto

Valores de **p** cercanos a cero -> Alta calidad

¿Cuál es la calidad si el valor p del basecall es de 0.01?

<div class="centered">
**Q = -10 * log10(0.01)** = -10 * -2 = **20**
</div>

## FastQ | Calidad
<div class="black">
- Para evitar colocar los valores numéricos de la calidad en el archivo .fastq y saturarlo de información -> **ASCII**
- El código ASCII lo pueden consultar [aquí](https://www.ascii-code.com/)
- Phred + 33 -> Plataformas de Illumina a partir de 1.8 (símbolos especiales + alfanuméricos)
- Phred + 64 -> Plataformas de Illumina anteriores a 1.8

<div class="columns-2">

  <img src="../Images/ASCII0.png" alt="ASCII0" width="450"/>

  <img src="../Images/ASCII33.png" alt="ASCII33" width="450"/>
</div>

## FastQ
<div class="centered">
  <img src="../Images/Fastq.png" alt="fastq" width="800"/>
</div>

## SAM/BAM
<div class="black">
- De manera posterior al lineamiento se generan archivos **"Sequence Alignment Map"** -> **SAM**
- Archivos delimitados por tabuladores (TAB)
- Convertidos a valores binarios como **"Binary Alignment Map"** -> **BAM**
- **BAM** -> Mayor espacio en disco -> Acceso aleatorio más eficiente
- Las secuencias en formato BAM se pueden ordenar por coordenadas
- Conversion entre formatos (SamTools!)
</div>

## SAM/BAM
<div class="black">
- Los archivos en formato **SAM** se dividen en dos secciones:

* **HEADER**: Información general del archivo

* **Alignment**: Información sobre el alineamiento de cada lectura
</div>

## SAM/BAM | HEADER
<div class="black">
- La sección HEADER incuye unformación sobre cómo se generó el alineamiento y su almacenamiento
- **Todas** las líneas del HEADER están separadas por tabuladores
- La estructura general de las líneas es la siguiente:

   @ TAG:VALUE

* TAG: Código de dos letras -> Contenido
* VALUE: Valores del TAG
</div>

## SAM/BAM | HEADER
<div class="black">
Ejemplos de diferentes **TAG**:

- @HD -> Metadatos del alineamiento
- @SQ -> Datos de la secuencia de referencia
- @RG -> Grupo de lecturas 
- @PG -> Información del alineador y el código del alineamiento
</div>

## SAM/BAM | ALLIGNMENT
<div class="black">
Esta sección procede al **HEADER** y contiene:

- Cada línea corresponde a una lectura alineada
- Para cada lectura se muestran los resultados de los siguientes campos obligatorios:

  QNAME : **FLAG** : RNAME : POS : MAPQ : **CIGAR** : MRNM : MPOS : ISIZE : SEQ : QUAL
</div>

## SAM/BAM | FLAG
<div class="black">
- Los valores del FLAG contestan preguntas relacionadas con el alineamiento del read
- Sí = 1, No = 0
- Cada respuesta se encuentra codificada en valores **binarios, decimales y hexadecimales**
- Información útil para lecturas pareadas -> ¿La lectura es pareada?
                                              ¿Ambos reads alinearon adecuadamente?
</div>

## SAM/BAM | FLAG

<div class="centered">
  <img src="../Images/flag.png" alt="flag" width="800"/>
</div>

## SAM/BAM | Concise Idiosyncratic Gapped Alignment Report (CIGAR)
<div class="black">
- Almacena información relacionada con las operaciones necesarias para linear el read
- Se reporta con valores alfanuméricos:

  * M -> Alineamiento correcto
  * I -> Inserción comparado con la referencia
  * D -> Deleción comparado con la referencia
  * N -> Región con corrimiento (intrón)
  * S -> Soft clipping
  * H -> Hard clipping
  * P -> Padding o mutación silenciosa
 </div>
 
## SAM/BAM | CIGAR

<div class="centered">
  <img src="../Images/cigar.png" alt="cigar" width="800"/>
</div>


